# نظام الرسوم الإضافية - وثائق المطور

## نظرة عامة
تم إنشاء نظام شامل لإدارة الرسوم الإضافية للطلاب مع هيكلة منظمة وواجهات مستخدم متطورة.

## هيكلة الملفات

### النماذج (Models)
- `lib/models/additional_fee_model.dart` - نموذج بيانات الرسم الإضافي

### الخدمات (Services)
- `lib/services/additional_fee_service.dart` - خدمات إدارة الرسوم الإضافية

### الواجهات (Pages/Dialogs)
- `lib/pages/additional_fees_dialog.dart` - النافذة الرئيسية للرسوم الإضافية
- `lib/pages/add_additional_fee_dialog.dart` - نافذة إضافة رسم جديد
- `lib/pages/print_additional_fees_dialog.dart` - نافذة طباعة إيصال الرسوم

## قاعدة البيانات

### جدول additional_fees
```sql
CREATE TABLE additional_fees (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    student_id INTEGER NOT NULL,
    fee_type TEXT NOT NULL,
    amount DECIMAL(10,2) NOT NULL,
    paid BOOLEAN DEFAULT FALSE,
    payment_date DATE,
    added_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    notes TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (student_id) REFERENCES students(id) ON DELETE CASCADE
)
```

### الفهارس
- `idx_additional_fees_student_id` - فهرس معرف الطالب
- `idx_additional_fees_paid` - فهرس حالة الدفع

## الوظائف الرئيسية

### النافذة الرئيسية للرسوم الإضافية
- عرض معلومات الطالب والصف
- ملخص مالي شامل (عدد الرسوم، المجموع، المدفوع، غير المدفوع)
- جدول تفصيلي للرسوم مع إمكانية التحكم
- أزرار إضافة، حذف، تغيير حالة الدفع
- إمكانية طباعة إيصال الرسوم

### نافذة إضافة رسم جديد
- أنواع رسوم محددة مسبقاً
- إمكانية إضافة نوع مخصص
- تحديد المبلغ وحالة الدفع
- تاريخ الدفع (عند التسديد المسبق)
- ملاحظات اختيارية

### نافذة طباعة الإيصال
- تصفية الرسوم (الكل، المدفوع، غير المدفوع)
- اختيار رسوم متعددة للطباعة
- معاينة قبل الطباعة
- إمكانية تخصيص القوالب

## الخدمات المتاحة

### خدمة AdditionalFeeService
- `insertAdditionalFee()` - إدراج رسم جديد
- `updateAdditionalFee()` - تحديث رسم موجود
- `deleteAdditionalFee()` - حذف رسم
- `getStudentAdditionalFees()` - جلب رسوم الطالب
- `getPaidFees()` - جلب الرسوم المدفوعة
- `getUnpaidFees()` - جلب الرسوم غير المدفوعة
- `getTotalFeesAmount()` - حساب إجمالي الرسوم
- `getTotalPaidAmount()` - حساب إجمالي المدفوع
- `getTotalUnpaidAmount()` - حساب إجمالي غير المدفوع
- `getFeesCount()` - عدد الرسوم
- `payFee()` - تسديد رسم
- `unpayFee()` - إلغاء تسديد رسم
- `searchAdditionalFees()` - البحث في الرسوم
- `getFilteredFees()` - تصفية الرسوم
- `getUsedFeeTypes()` - أنواع الرسوم المستخدمة

## التكامل مع النظام

### تحديثات صفحة تفاصيل الطالب
- تم إضافة زر "الرسوم الإضافية" في شريط الأزرار
- ربط الزر بالنافذة الرئيسية للرسوم الإضافية

### تحديثات قاعدة البيانات
- رفع رقم إصدار قاعدة البيانات إلى 5
- إضافة جدول الرسوم الإضافية مع الفهارس المطلوبة

## أنواع الرسوم المحددة مسبقاً
1. رسوم امتحانات
2. رسوم كتب
3. رسوم نشاطات
4. رسوم مختبر
5. رسوم مكتبة
6. رسوم نقل
7. رسوم زي مدرسي
8. رسوم إضافية أخرى
9. نوع مخصص (يسمح بإدخال نوع جديد)

## المزايا الرئيسية

### سهولة الاستخدام
- واجهات باللغة العربية مع دعم الـ RTL
- تصميم منطقي ومنظم
- رسائل تأكيد وتنبيه واضحة

### الأمان والموثوقية
- تحقق من صحة البيانات المدخلة
- معالجة الأخطاء بشكل صحيح
- استخدام المعاملات في قاعدة البيانات

### المرونة
- إمكانية تخصيص أنواع الرسوم
- تصفية وبحث متقدم
- دعم الطباعة والمعاينة

## ملاحظات للتطوير المستقبلي
- يمكن إضافة المزيد من أنواع الرسوم
- تطوير نظام الطباعة الفعلي
- إضافة تقارير تفصيلية
- دعم الرسوم المجدولة والمتكررة
- تصدير البيانات بصيغ مختلفة

## كيفية الاستخدام

### للمطورين
1. استيراد الخدمات المطلوبة
2. استخدام `AdditionalFeeService` للعمليات على البيانات
3. استخدام النوافذ الجاهزة للواجهات

### للمستخدمين
1. الدخول إلى صفحة تفاصيل الطالب
2. النقر على زر "الرسوم الإضافية"
3. إدارة الرسوم من خلال الواجهة المتكاملة
